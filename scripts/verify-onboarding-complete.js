#!/usr/bin/env node

/**
 * Verification script to ensure onboarding system is 100% complete
 * Checks all components exist and are properly imported
 */

const fs = require('fs')
const path = require('path')

console.log('ğŸ” Verifying Onboarding System Completeness...\n')

// Components that should exist
const requiredComponents = [
  'components/onboarding/PlatformTailoredImport.js',
  'components/onboarding/DataVerificationSetup.js',
  'components/onboarding/BusinessPlanningSetup.js',
  'components/onboarding/LocationManagementSetup.js',
  'components/dashboard/DashboardOnboarding.js',
  'components/onboarding/AdaptiveFlowEngine.js',
  'components/onboarding/WelcomeSegmentation.js'
]

// Check if all components exist
console.log('ğŸ“ Checking Component Files:')
let allFilesExist = true

requiredComponents.forEach(component => {
  const filePath = path.join(process.cwd(), component)
  const exists = fs.existsSync(filePath)
  
  if (exists) {
    console.log(`  âœ… ${component}`)
  } else {
    console.log(`  âŒ ${component} - MISSING`)
    allFilesExist = false
  }
})

console.log('\nğŸ“ Checking DashboardOnboarding.js Imports:')

// Read DashboardOnboarding.js and check imports
const dashboardPath = path.join(process.cwd(), 'components/dashboard/DashboardOnboarding.js')
const dashboardContent = fs.readFileSync(dashboardPath, 'utf8')

const requiredImports = [
  'PlatformTailoredImport',
  'DataVerificationSetup', 
  'BusinessPlanningSetup',
  'LocationManagementSetup'
]

let allImportsPresent = true

requiredImports.forEach(importName => {
  if (dashboardContent.includes(`import ${importName}`)) {
    console.log(`  âœ… ${importName} imported`)
  } else {
    console.log(`  âŒ ${importName} NOT imported`)
    allImportsPresent = false
  }
})

console.log('\nğŸ”„ Checking Step ID Handling:')

// Check if all step IDs are handled
const stepIds = [
  'data_import',
  'data_verification',
  'business_planning',
  'location_management',
  'analytics_setup',
  'ai_training'
]

let allStepsHandled = true

stepIds.forEach(stepId => {
  if (dashboardContent.includes(`case '${stepId}':`)) {
    console.log(`  âœ… Step "${stepId}" handled`)
  } else {
    console.log(`  âŒ Step "${stepId}" NOT handled`)
    allStepsHandled = false
  }
})

console.log('\nğŸš« Checking for "Coming Soon" Placeholders:')

// Check for problematic placeholders
const problematicPhrases = [
  'is coming soon',
  'Future coming soon',
  'feature is under development'
]

let hasPlaceholders = false

problematicPhrases.forEach(phrase => {
  if (dashboardContent.includes(phrase)) {
    console.log(`  âš ï¸  Found "${phrase}" in DashboardOnboarding.js`)
    hasPlaceholders = true
  }
})

if (!hasPlaceholders) {
  console.log('  âœ… No generic "coming soon" placeholders found')
}

console.log('\nğŸ“Š Checking AdaptiveFlowEngine.js Step Generation:')

// Read AdaptiveFlowEngine.js to verify step generation
const enginePath = path.join(process.cwd(), 'components/onboarding/AdaptiveFlowEngine.js')
if (fs.existsSync(enginePath)) {
  const engineContent = fs.readFileSync(enginePath, 'utf8')
  
  const dynamicSteps = [
    'data_import',
    'data_verification',
    'business_planning',
    'location_management'
  ]
  
  dynamicSteps.forEach(step => {
    if (engineContent.includes(`'${step}'`) || engineContent.includes(`"${step}"`)) {
      console.log(`  âœ… Step "${step}" generated by AdaptiveFlowEngine`)
    } else {
      console.log(`  âš ï¸  Step "${step}" may not be generated`)
    }
  })
}

console.log('\n' + '='.repeat(50))
console.log('ğŸ“ˆ VERIFICATION SUMMARY:')
console.log('='.repeat(50))

const issues = []

if (!allFilesExist) {
  issues.push('Some component files are missing')
}

if (!allImportsPresent) {
  issues.push('Some components are not imported in DashboardOnboarding.js')
}

if (!allStepsHandled) {
  issues.push('Some step IDs are not handled in the switch statement')
}

if (hasPlaceholders) {
  issues.push('Generic placeholders still exist')
}

if (issues.length === 0) {
  console.log('\nâœ… SUCCESS: Onboarding system is 100% complete!')
  console.log('   - All components exist')
  console.log('   - All imports are present')
  console.log('   - All step IDs are handled')
  console.log('   - No generic placeholders remain')
  console.log('\nğŸš€ The system is production-ready!')
} else {
  console.log('\nâš ï¸  ISSUES FOUND:')
  issues.forEach(issue => {
    console.log(`   - ${issue}`)
  })
  console.log('\nâŒ Please address these issues before deployment')
  process.exit(1)
}

console.log('\nğŸ“‹ Test Commands:')
console.log('   npm run test:e2e -- tests/e2e/onboarding-complete.spec.js')
console.log('   npm run build')
console.log('   npm run dev (then visit http://localhost:9999/dashboard)\n')
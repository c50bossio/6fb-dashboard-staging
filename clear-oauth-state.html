<!DOCTYPE html>
<html>
<head>
    <title>Clear OAuth State</title>
</head>
<body>
    <h1>Clearing OAuth State...</h1>
    <div id="result">Processing...</div>
    
    <script>
        // Clear all possible OAuth-related storage
        
        // 1. Clear localStorage
        Object.keys(localStorage).forEach(key => {
            if (key.includes('supabase') || key.includes('oauth') || key.includes('auth')) {
                localStorage.removeItem(key);
                console.log('Removed localStorage:', key);
            }
        });
        
        // 2. Clear sessionStorage
        Object.keys(sessionStorage).forEach(key => {
            if (key.includes('supabase') || key.includes('oauth') || key.includes('auth')) {
                sessionStorage.removeItem(key);
                console.log('Removed sessionStorage:', key);
            }
        });
        
        // 3. Clear specific Supabase cookies
        const cookiesToClear = [
            'sb-auth-token',
            'sb-auth-token-code-verifier',
            'supabase-auth-token',
            'supabase.auth.token'
        ];
        
        cookiesToClear.forEach(cookie => {
            // Clear for current domain
            document.cookie = `${cookie}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;
            // Clear for localhost
            document.cookie = `${cookie}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=localhost;`;
            console.log('Cleared cookie:', cookie);
        });
        
        // 4. Call force logout API
        fetch('/api/auth/force-logout', {
            method: 'POST',
            credentials: 'include'
        }).then(response => {
            console.log('Force logout response:', response.status);
            
            document.getElementById('result').innerHTML = `
                <h2>✅ OAuth State Cleared!</h2>
                <p>All storage and cookies have been cleared.</p>
                <p>Force logout API called: ${response.status}</p>
                <br>
                <a href="/login" style="background: #4F46E5; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">
                    Go to Login Page
                </a>
            `;
        }).catch(error => {
            console.error('Force logout error:', error);
            document.getElementById('result').innerHTML = `
                <h2>✅ OAuth State Cleared!</h2>
                <p>All storage and cookies have been cleared.</p>
                <p>Note: Force logout API failed, but local state is cleared.</p>
                <br>
                <a href="/login" style="background: #4F46E5; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">
                    Go to Login Page
                </a>
            `;
        });
    </script>
</body>
</html>
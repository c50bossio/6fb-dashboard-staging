<!DOCTYPE html>
<html>
<head>
    <title>Unregister Service Worker</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #ef4444;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #dc2626;
        }
        .success {
            background: #10b981;
        }
        .success:hover {
            background: #059669;
        }
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            display: none;
        }
        .status.show {
            display: block;
        }
        .status.success {
            background: #d1fae5;
            color: #065f46;
        }
        .status.error {
            background: #fee2e2;
            color: #991b1b;
        }
        code {
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Service Worker Manager</h1>
        <p>The service worker is causing issues with the onboarding modal. Use these tools to fix it:</p>
        
        <h2>Quick Fix Options:</h2>
        
        <button onclick="unregisterServiceWorker()">
            üö´ Unregister Service Worker
        </button>
        
        <button onclick="clearAllCaches()">
            üóëÔ∏è Clear All Caches
        </button>
        
        <button onclick="hardReset()" class="success">
            üîÑ Complete Reset (Recommended)
        </button>
        
        <div id="status" class="status"></div>
        
        <h3>Manual Instructions:</h3>
        <ol>
            <li>Open Chrome DevTools (F12)</li>
            <li>Go to Application tab</li>
            <li>Click on "Service Workers" in left sidebar</li>
            <li>Click "Unregister" next to any service workers</li>
            <li>Go to "Storage" in left sidebar</li>
            <li>Click "Clear site data"</li>
            <li>Refresh the page</li>
        </ol>
        
        <h3>Or run this in console:</h3>
        <code>
            navigator.serviceWorker.getRegistrations().then(regs => regs.forEach(r => r.unregister()))
        </code>
    </div>
    
    <script>
        function showStatus(message, isSuccess = true) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status show ${isSuccess ? 'success' : 'error'}`;
        }
        
        async function unregisterServiceWorker() {
            try {
                if ('serviceWorker' in navigator) {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    
                    if (registrations.length === 0) {
                        showStatus('No service workers found to unregister.', false);
                        return;
                    }
                    
                    for (let registration of registrations) {
                        await registration.unregister();
                        console.log('Service worker unregistered:', registration);
                    }
                    
                    showStatus(`‚úÖ Successfully unregistered ${registrations.length} service worker(s)!`);
                } else {
                    showStatus('Service workers not supported in this browser.', false);
                }
            } catch (error) {
                showStatus(`‚ùå Error: ${error.message}`, false);
            }
        }
        
        async function clearAllCaches() {
            try {
                const cacheNames = await caches.keys();
                
                if (cacheNames.length === 0) {
                    showStatus('No caches found to clear.', false);
                    return;
                }
                
                for (let name of cacheNames) {
                    await caches.delete(name);
                    console.log('Cache deleted:', name);
                }
                
                showStatus(`‚úÖ Successfully cleared ${cacheNames.length} cache(s)!`);
            } catch (error) {
                showStatus(`‚ùå Error: ${error.message}`, false);
            }
        }
        
        async function hardReset() {
            try {
                // 1. Unregister all service workers
                if ('serviceWorker' in navigator) {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    for (let registration of registrations) {
                        await registration.unregister();
                    }
                }
                
                // 2. Clear all caches
                const cacheNames = await caches.keys();
                for (let name of cacheNames) {
                    await caches.delete(name);
                }
                
                // 3. Clear localStorage
                localStorage.clear();
                
                // 4. Clear sessionStorage
                sessionStorage.clear();
                
                showStatus('‚úÖ Complete reset successful! Redirecting to dashboard in 3 seconds...');
                
                // 5. Redirect to dashboard
                setTimeout(() => {
                    window.location.href = '/dashboard';
                }, 3000);
                
            } catch (error) {
                showStatus(`‚ùå Error: ${error.message}`, false);
            }
        }
        
        // Check current status on load
        window.addEventListener('load', async () => {
            if ('serviceWorker' in navigator) {
                const registrations = await navigator.serviceWorker.getRegistrations();
                if (registrations.length > 0) {
                    showStatus(`‚ö†Ô∏è ${registrations.length} service worker(s) currently registered.`, false);
                } else {
                    showStatus('‚úÖ No service workers currently registered.');
                }
            }
        });
    </script>
</body>
</html>
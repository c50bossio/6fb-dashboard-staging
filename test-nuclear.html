<!DOCTYPE html>
<html>
<head>
    <title>Nuclear Input Test</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        .input-field {
            width: 300px;
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin: 10px;
        }
        .test-container {
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        .result {
            margin: 10px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useRef, useEffect, forwardRef, memo } = React;
        
        // NUCLEAR INPUT COMPONENT
        const NuclearInput = memo(forwardRef(({ 
          type = 'text', 
          defaultValue = '', 
          onBlur,
          placeholder = '', 
          className = 'input-field',
          name,
          ...props 
        }, ref) => {
          const inputRef = useRef(null)
          const actualRef = ref || inputRef
          const initialValue = useRef(defaultValue)
          const isInitialized = useRef(false)
          
          // Set initial value and handle defaultValue updates
          useEffect(() => {
            if (actualRef.current) {
              if (!isInitialized.current || (defaultValue && defaultValue !== initialValue.current)) {
                console.log('NUCLEAR: Setting value to', defaultValue, 'for input type', type)
                actualRef.current.value = defaultValue || ''
                initialValue.current = defaultValue || ''
                isInitialized.current = true
              }
            }
          }, [defaultValue, type])
          
          // Handle blur event
          const handleBlur = (e) => {
            if (onBlur) {
              onBlur(e)
            }
          }
          
          // Prevent React from interfering
          useEffect(() => {
            const input = actualRef.current
            if (!input) return
            
            // Get original value descriptor
            const originalDescriptor = Object.getOwnPropertyDescriptor(HTMLInputElement.prototype, 'value')
            const originalValueGetter = originalDescriptor.get
            const originalValueSetter = originalDescriptor.set
            
            Object.defineProperty(input, 'value', {
              get() {
                return originalValueGetter.call(input)
              },
              set(newValue) {
                originalValueSetter.call(input, newValue)
                console.log('NUCLEAR: Set value to:', newValue)
              }
            })
            
          }, [])
          
          return React.createElement('input', {
            ref: actualRef,
            type: type,
            name: name,
            onBlur: handleBlur,
            placeholder: placeholder,
            className: className,
            autoComplete: "new-password",
            ...props
          })
        }))
        
        // TEST COMPONENT
        function TestApp() {
          const [phoneValue, setPhoneValue] = useState('+1 (555) 123-4567')
          const [emailValue, setEmailValue] = useState('demo@test.com')
          const [results, setResults] = useState([])
          
          const addResult = (test, result, success) => {
            setResults(prev => [...prev, { test, result, success, time: new Date().toLocaleTimeString() }])
          }
          
          const testClearAndType = async () => {
            const phoneInput = document.querySelector('input[type="tel"]')
            const emailInput = document.querySelector('input[type="email"]')
            
            // Test phone
            phoneInput.value = ''
            phoneInput.value = '+1 555 CLEAR-TEST'
            addResult('Phone Clear+Type', phoneInput.value, phoneInput.value === '+1 555 CLEAR-TEST')
            
            // Test email
            emailInput.value = ''
            emailInput.value = 'clear@test.com'
            addResult('Email Clear+Type', emailInput.value, emailInput.value === 'clear@test.com')
          }
          
          const testTyping = () => {
            const emailInput = document.querySelector('input[type="email"]')
            emailInput.focus()
            emailInput.value = ''
            
            const testEmail = 'typing@test.com'
            let currentValue = ''
            
            for (let char of testEmail) {
              currentValue += char
              emailInput.value = currentValue
            }
            
            addResult('Character Typing', emailInput.value, emailInput.value === testEmail)
          }
          
          return React.createElement('div', { className: 'test-container' },
            React.createElement('h1', {}, 'Nuclear Input Test'),
            
            React.createElement('div', {},
              React.createElement('label', {}, 'Phone: '),
              React.createElement(NuclearInput, {
                type: 'tel',
                placeholder: 'Enter phone number',
                defaultValue: phoneValue,
                onBlur: (e) => setPhoneValue(e.target.value)
              })
            ),
            
            React.createElement('div', {},
              React.createElement('label', {}, 'Email: '),
              React.createElement(NuclearInput, {
                type: 'email',
                placeholder: 'Enter email address', 
                defaultValue: emailValue,
                onBlur: (e) => setEmailValue(e.target.value)
              })
            ),
            
            React.createElement('div', {},
              React.createElement('button', { onClick: testClearAndType }, 'Test Clear & Type'),
              React.createElement('button', { onClick: testTyping }, 'Test Character Typing')
            ),
            
            React.createElement('div', {},
              React.createElement('h3', {}, 'Results:'),
              results.map((r, i) => 
                React.createElement('div', { key: i, className: 'result' },
                  `${r.time} - ${r.test}: "${r.result}" - ${r.success ? '✅ SUCCESS' : '❌ FAILED'}`
                )
              )
            )
          )
        }
        
        ReactDOM.render(React.createElement(TestApp), document.getElementById('root'))
    </script>
</body>
</html>
<!DOCTYPE html>
<html>
<head>
    <title>FullCalendar RRule Test - FIXED</title>
    <!-- Core FullCalendar -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <!-- RRule library (required dependency) -->
    <script src="https://cdn.jsdelivr.net/npm/rrule@2.6.4/dist/es5/rrule.min.js"></script>
    <!-- FullCalendar RRule Plugin -->
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/rrule@6.1.8/index.global.min.js"></script>
</head>
<body>
    <h1>üîÑ FullCalendar RRule Test - FIXED VERSION</h1>
    <div id="calendar" style="max-width: 900px; margin: 0 auto;"></div>
    <div id="debug" style="margin: 20px; padding: 10px; background: #f0f0f0; border-radius: 5px;">
        <h3>Debug Info:</h3>
        <div id="debug-content"></div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const calendarEl = document.getElementById('calendar');
        const debugEl = document.getElementById('debug-content');
        
        // Test event with RRule - same as our API data
        const testEvent = {
            id: 'rrule-test-1',
            title: 'üîÑ Weekly Test - Eldred Rippin',
            start: '2025-08-11T13:00:00',
            end: '2025-08-11T13:20:00',
            rrule: 'FREQ=WEEKLY;INTERVAL=1;COUNT=4',
            backgroundColor: '#3b82f6'
        };
        
        console.log('Creating calendar with RRule event:', testEvent);
        
        // Debug: Check if rrule plugin is available
        debugEl.innerHTML = `
            <p><strong>FullCalendar version:</strong> ${FullCalendar.VERSION || 'Unknown'}</p>
            <p><strong>RRule library available:</strong> ${typeof RRule !== 'undefined' ? 'Yes' : 'No'}</p>
            <p><strong>FullCalendar RRule plugin:</strong> ${typeof FullCalendar.RRule !== 'undefined' ? 'Yes' : 'No'}</p>
            <p><strong>Event with RRule:</strong> ${testEvent.rrule}</p>
        `;
        
        const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'timeGridWeek',
            initialDate: '2025-08-11', // Start with original date
            
            headerToolbar: {
                left: 'prev,next today',
                center: 'title', 
                right: 'dayGridMonth,timeGridWeek'
            },
            
            events: [testEvent],
            
            eventClick: function(info) {
                const isRecurring = info.event.extendedProps.recurring || (info.event._def && info.event._def.recurringDef);
                alert(`Event: ${info.event.title}
Date: ${info.event.start.toDateString()}
Time: ${info.event.start.toLocaleTimeString()}
Recurring: ${isRecurring ? 'Yes' : 'No'}
RRule: ${testEvent.rrule}`);
            },
            
            eventDidMount: function(info) {
                const isRecurring = info.event._def && info.event._def.recurringDef;
                console.log('Event rendered:', {
                    id: info.event.id,
                    title: info.event.title,
                    start: info.event.start.toISOString(),
                    isRecurring: isRecurring,
                    hasRecurringDef: !!info.event._def.recurringDef
                });
            }
        });
        
        calendar.render();
        
        // Add navigation buttons
        setTimeout(() => {
            const container = document.body;
            const navDiv = document.createElement('div');
            navDiv.style.cssText = 'text-align: center; margin: 20px; padding: 15px; background: #e3f2fd; border-radius: 8px;';
            navDiv.innerHTML = `
                <h3>üóìÔ∏è Navigation Test - Click to Jump to Different Weeks</h3>
                <p>The RRule should generate instances on each of these weeks:</p>
                <button onclick="calendar.gotoDate('2025-08-11')" style="margin: 5px; padding: 10px 15px; background: #2196f3; color: white; border: none; border-radius: 5px;">Week 1 (Aug 11) - Original</button>
                <button onclick="calendar.gotoDate('2025-08-18')" style="margin: 5px; padding: 10px 15px; background: #4caf50; color: white; border: none; border-radius: 5px;">Week 2 (Aug 18) - Recurring</button>
                <button onclick="calendar.gotoDate('2025-08-25')" style="margin: 5px; padding: 10px 15px; background: #ff9800; color: white; border: none; border-radius: 5px;">Week 3 (Aug 25) - Recurring</button>
                <button onclick="calendar.gotoDate('2025-09-01')" style="margin: 5px; padding: 10px 15px; background: #9c27b0; color: white; border: none; border-radius: 5px;">Week 4 (Sep 1) - Recurring</button>
            `;
            container.appendChild(navDiv);
            
            // Update debug info with event count
            const events = calendar.getEvents();
            debugEl.innerHTML += `<p><strong>Total events loaded:</strong> ${events.length}</p>`;
            events.forEach((event, i) => {
                debugEl.innerHTML += `<p><strong>Event ${i+1}:</strong> ${event.title} at ${event.start.toISOString()}</p>`;
            });
            
        }, 1000);
        
    });
    </script>
</body>
</html>
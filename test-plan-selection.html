<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan Selection Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .log-entry { margin: 5px 0; padding: 5px; background: #f8f9fa; border-left: 3px solid #007bff; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .success { border-left-color: #28a745; background: #d4edda; }
    </style>
</head>
<body>
    <h1>ðŸ§ª Plan Selection Test</h1>
    
    <div class="test-section">
        <h2>Test Instructions</h2>
        <ol>
            <li>Open the registration page: <a href="http://localhost:9999/register" target="_blank">http://localhost:9999/register</a></li>
            <li>Fill out steps 1 and 2 to reach step 3 (Plan selection)</li>
            <li>Click on different plans (Starter, Professional, Enterprise)</li>
            <li>Watch the console below and check if the "Create account" button remains visible</li>
        </ol>
        <button class="button" onclick="openRegistrationPage()">Open Registration Page</button>
        <button class="button" onclick="testPlanSelection()">Test Plan Selection Logic</button>
    </div>
    
    <div class="test-section">
        <h2>Plan Selection Test Results</h2>
        <div id="test-results"></div>
    </div>
    
    <div class="test-section">
        <h2>Console Monitor</h2>
        <div id="console-monitor" style="max-height: 300px; overflow-y: auto; background: #f8f9fa; padding: 10px;"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const monitor = document.getElementById('console-monitor');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            monitor.appendChild(entry);
            monitor.scrollTop = monitor.scrollHeight;
            console.log(message);
        }
        
        function openRegistrationPage() {
            log('Opening registration page in new tab...', 'info');
            window.open('http://localhost:9999/register', '_blank');
        }
        
        function testPlanSelection() {
            log('Testing plan selection logic...', 'info');
            
            // Simulate the plan selection logic from the registration form
            let formData = { selectedPlan: 'professional' };
            let errors = {};
            
            const handlePlanSelection = (planValue, e) => {
                try {
                    // Simulate the actual function
                    if (e) {
                        e.preventDefault();
                        e.stopPropagation();
                    }
                    log(`Plan selected: ${planValue}`, 'success');
                    
                    formData = {
                        ...formData,
                        selectedPlan: planValue
                    };
                    
                    // Clear plan selection error if any
                    if (errors.selectedPlan) {
                        errors = {
                            ...errors,
                            selectedPlan: ''
                        };
                    }
                    
                    log(`Form data updated: selectedPlan = ${formData.selectedPlan}`, 'info');
                    return true;
                    
                } catch (error) {
                    log(`Error in plan selection: ${error.message}`, 'error');
                    return false;
                }
            };
            
            // Test all three plans
            const plans = ['starter', 'professional', 'enterprise'];
            const results = document.getElementById('test-results');
            results.innerHTML = '<h3>Testing Plan Selection:</h3>';
            
            plans.forEach(plan => {
                const mockEvent = { preventDefault: () => {}, stopPropagation: () => {} };
                const success = handlePlanSelection(plan, mockEvent);
                results.innerHTML += `<p class="${success ? 'success' : 'error'}">âœ“ ${plan.charAt(0).toUpperCase() + plan.slice(1)} plan: ${success ? 'SUCCESS' : 'FAILED'}</p>`;
            });
            
            log('Plan selection test completed', 'success');
        }
        
        // Monitor for messages from registration page
        window.addEventListener('message', function(event) {
            if (event.origin !== 'http://localhost:9999') return;
            log(`Message from registration page: ${JSON.stringify(event.data)}`, 'info');
        });
        
        log('Plan Selection Test Tool loaded', 'success');
    </script>
</body>
</html>